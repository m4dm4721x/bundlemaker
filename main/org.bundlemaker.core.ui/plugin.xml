<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>

   <!-- -->
   <extension point="org.eclipse.ui.navigator.navigatorContent">
      <navigatorContent activeByDefault="true"
         contentProvider="org.bundlemaker.core.ui.view.navigator.ArtifactTreeContentProvider"
         icon="icons/navigator/root.gif" id="org.bundlemaker.core.analysis.ui.navigatorContent1"
         labelProvider="org.bundlemaker.core.ui.view.navigator.ArtifactTreeLabelProvider"
         name="artifactContent" priority="lowest">
         <triggerPoints>
            <and>
               <instanceof value="org.eclipse.core.resources.IProject"> </instanceof>
               <adapt type="org.eclipse.core.resources.IProject">
                  <test property="org.eclipse.core.resources.projectNature"
                     value="org.bundlemaker.core.bundlemakernature"/>
               </adapt>
            </and>
         </triggerPoints>
      </navigatorContent>
   </extension>

   <!-- the navigator content-->
   <extension point="org.eclipse.ui.navigator.viewer">
      <viewer viewerId="org.eclipse.ui.navigator.ProjectExplorer"> </viewer>
      <viewerContentBinding viewerId="org.eclipse.ui.navigator.ProjectExplorer">
         <includes>
            <contentExtension isRoot="false"
               pattern="org.bundlemaker.core.analysis.ui.navigatorContent1"> </contentExtension>
         </includes>
      </viewerContentBinding>
   </extension>

   <!-- the IArtifact property tester -->
   <extension
         point="org.eclipse.core.expressions.propertyTesters">
      <propertyTester id="org.bundlemaker.core.analysis.ui.expressions.ArtifactPropertyTester"
            class="org.bundlemaker.core.ui.expressions.ArtifactPropertyTester"
            namespace="org.bundlemaker.core.analysis.ui.expressions.IArtifact"
            properties="type"
            type="org.bundlemaker.analysis.model.IArtifact">
      </propertyTester>
   </extension>
   
   <!-- the expression definitions -->
   
   <!-- org.bundlemaker.core.analysis.ui.bmContentSelected: evaluates
        to true if all  of the selected elements are IArtifact -->
   <extension
         point="org.eclipse.core.expressions.definitions">
      <definition
            id="org.bundlemaker.core.ui.bmContentSelected">
            <with
                  variable="selection">
                  <iterate ifEmpty="false" operator="and">
                  <instanceof
                        value="org.bundlemaker.analysis.model.IArtifact">
                  </instanceof>
                  </iterate>
            </with>
      </definition>
   </extension>

   <!-- org.bundlemaker.core.analysis.ui.bmContentSelected: evaluates
        to true if all selected elements are Root-IArtifacts (i.e. ModularizedSystems) -->
    <extension
       point="org.eclipse.core.expressions.definitions">
    <definition
          id="org.bundlemaker.core.ui.bmRootArtifactSelected">
          <with
                variable="selection">
                <iterate ifEmpty="false" operator="and">
                <instanceof
                      value="org.bundlemaker.analysis.model.IArtifact">
                </instanceof>
                <test property="org.bundlemaker.core.analysis.ui.expressions.IArtifact.type" value="Root" 
                	forcePluginActivation="true"/>
                </iterate>
          </with>
    </definition>
   </extension> 
   
   <!-- An expression evaluating to true if a BMT-file has been selected -->
	<extension point="org.eclipse.core.expressions.definitions">
      <definition id="org.bundlemaker.core.ui.bmtFileSelected">
         <iterate ifEmpty="false">
         	<instanceof value="org.eclipse.core.resources.IFile" />
           <test property="org.eclipse.core.resources.name" 
                 value="*.bmt"/>
         </iterate>
      </definition>
   </extension>

   <!-- ======================================== -->
   <!-- the handlers -->
   <!-- ======================================== -->
   <extension
         point="org.eclipse.ui.handlers">
      <handler class="org.bundlemaker.core.ui.commands.DemoHandler"
            commandId="org.bundlemaker.core.ui.commands.Demo">
         <activeWhen>
         <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
         </reference>
         </activeWhen>
         <enabledWhen>
          <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
               </reference>
         </enabledWhen>
      </handler>
   </extension> 
      <extension
         point="org.eclipse.ui.handlers">
      <handler class="org.bundlemaker.core.ui.commands.PdePluginProjectExportHandler"
            commandId="org.bundlemaker.core.ui.commands.PdePluginProjectExportHandler">
         <activeWhen>
         <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
         </reference>
         </activeWhen>
         <enabledWhen>
          <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
               </reference>
         </enabledWhen>
      </handler>
   </extension> 
    <extension
         point="org.eclipse.ui.handlers">
      <handler class="org.bundlemaker.core.ui.commands.ReportExportHandler"
            commandId="org.bundlemaker.core.ui.commands.ReportExportHandler">
         <activeWhen>
         <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
         </reference>
         </activeWhen>
         <enabledWhen>
          <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
               </reference>
         </enabledWhen>
      </handler>
   </extension> 
     <extension
         point="org.eclipse.ui.handlers">
      <handler class="org.bundlemaker.core.ui.commands.BinaryBundleExportHandler"
            commandId="org.bundlemaker.core.ui.commands.BinaryBundleExportHandler">
         <activeWhen>
         <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
         </reference>
         </activeWhen>
         <enabledWhen>
          <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
               </reference>
         </enabledWhen>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler class="org.bundlemaker.core.ui.commands.TransformHandler"
            commandId="org.bundlemaker.core.ui.commands.TransformHandler">
         <activeWhen>
         <reference
               definitionId="org.bundlemaker.core.ui.bmContentSelected">
         </reference>
         </activeWhen>
         <enabledWhen>
          <reference
               definitionId="org.bundlemaker.core.ui.bmRootArtifactSelected">
               </reference>
         </enabledWhen>
      </handler>
   </extension>    
   <extension
         point="org.eclipse.ui.handlers">
      <handler class="org.bundlemaker.core.ui.commands.RunTransformationScriptHandler"
            commandId="org.bundlemaker.core.ui.commands.RunTransformationScript">
         <activeWhen>
         	<or>
          <reference
               definitionId="org.bundlemaker.core.ui.bmtFileSelected" />
               <reference
                    definitionId="org.bundlemaker.core.transformations.dsl.TransformationDsl.Editor.opened"/>
          	</or>
         </activeWhen>
         <enabledWhen>
         	<or>
          <reference
               definitionId="org.bundlemaker.core.ui.bmtFileSelected" />
               <reference
                    definitionId="org.bundlemaker.core.transformations.dsl.TransformationDsl.Editor.opened"/>
          	</or>
         </enabledWhen>
      </handler>
   </extension>    
   
<!-- ======================================== -->

<!--
   <extension
       point="org.eclipse.jdt.ui.javaElementFilters">
    <filter
          class="org.bundlemaker.core.ui.internal.JavaElementFilter"
          description="Filters any bundlemaker JDT project."
          enabled="true"
          pattern="*$JDT"
          id="org.bundlemaker.core.ui.internal.JavaElementFilter"
          name="BundleMaker$JDT project filter">
    </filter>
 </extension>
 
 -->
   <!-- ======================================== -->
   <!-- wizards -->
   <!-- ======================================== -->
 
 	<!-- New BundleMaker project -->
   <extension
         id="org.bundlemaker.core.ui.newWizards"
         name="Bundlemaker Wizards"
         point="org.eclipse.ui.newWizards">
      <category
            id="org.bundlemaker.core.ui.wizards.category"
            name="Bundlemaker">
      </category>
      <wizard
            canFinishEarly="false"
            category="org.bundlemaker.core.ui.wizards.category"
            class="org.bundlemaker.core.ui.wizards.NewBundleMakerProjectWizard"
            hasPages="true"
            icon="icons/bundlemaker-icon-small.png"
            id="org.bundlemaker.core.ui.wizards.newwizard"
            name="Bundlemaker project"
            project="true">
         <description>
            Create a Bundlemaker project
         </description>
      </wizard>
      <wizard
            canFinishEarly="true"
            category="org.bundlemaker.core.ui.wizards.category"
            class="org.bundlemaker.core.ui.wizards.NewTransformationScriptWizard"
            hasPages="true"
            id="org.bundlemaker.core.ui.wizards.NewTransformationScriptWizard"
            name="Transformation script"
            project="false">
      </wizard>
   </extension>
  
   <!-- ======================================== -->
   <!-- editors -->
   <!-- ======================================== -->
  	<!-- Project description editor -->
   <extension
         id="org.bundlemaker.core.ui.editors"
         name="Bundlemaker Editors"
         point="org.eclipse.ui.editors">
      <editor
      	icon="icons/bundlemaker-icon-small.png"
            class="org.bundlemaker.core.ui.editor.ProjectDescriptionEditor"
            default="false"
            id="org.bundlemaker.core.ui.editor.projectdescription"
            name="Bundlemaker editor">
         <contentTypeBinding 
               contentTypeId="org.bundlemaker.core.ui.contenttypes.projectdescription">
         </contentTypeBinding>
      </editor>
   </extension>
   
   <!-- The BundleMaker project content type ('bundlemaker.xml') -->
   <extension
         id="org.bundlemaker.core.ui.contentTypes"
         name="Bundlemaker Contenttypes"
         point="org.eclipse.core.contenttype.contentTypes">
      <content-type
            base-type="org.eclipse.core.runtime.xml"
            file-names="bundlemaker.xml"
            id="org.bundlemaker.core.ui.contenttypes.projectdescription"
            name="Bundlemaker project description"
            priority="normal">
      </content-type>
   </extension>
   
   <!-- the commands -->
   <extension point="org.eclipse.ui.commands">
      <command id="org.bundlemaker.core.ui.commands.Demo" name="Demo" /> 
   </extension>
   <extension point="org.eclipse.ui.commands">
      <command id="org.bundlemaker.core.ui.commands.PdePluginProjectExportHandler" name="PDE Plug-in Projects" /> 
   </extension>  
   <extension point="org.eclipse.ui.commands">
      <command id="org.bundlemaker.core.ui.commands.ReportExportHandler" name="Simple Report" /> 
   </extension>   
   <extension point="org.eclipse.ui.commands">
      <command id="org.bundlemaker.core.ui.commands.BinaryBundleExportHandler" name="Binary bundles" /> 
   </extension>
   <extension point="org.eclipse.ui.commands">
      <command
            id="org.bundlemaker.core.ui.commands.TransformHandler"
            name="Transform..." />
   </extension>   
   <extension point="org.eclipse.ui.commands">
      <command id="org.bundlemaker.core.ui.commands.RunTransformationScript" name="Execute transformation..." /> 
   </extension> 

   <!-- ======================================== -->
   <!-- the pop up menus -->
   <!-- ======================================== -->
   <extension point="org.eclipse.ui.menus">
	   <menuContribution
	       locationURI="popup:org.eclipse.ui.navigator.ProjectExplorer#PopupMenu?after=additions">
	       <menu
	       		icon="icons/bundlemaker-icon-small.png" 
	       		id="org.bundlemaker.core.ui.ProjectExplorerPopupMenu"
              label="BundleMaker" >
            	<command commandId="org.bundlemaker.core.ui.commands.Demo"
              			 style="push">
           <visibleWhen
                 checkEnabled="true" />
	       </command>
         <command commandId="org.bundlemaker.core.ui.commands.TransformHandler"
          			 style="push" />
         <command commandId="org.bundlemaker.core.ui.commands.RunTransformationScript"
              			 style="push" />	       
	       </menu>
	   </menuContribution> 
   </extension>
   <!-- the "Export as" pop up menu -->
   <extension point="org.eclipse.ui.menus">
	   <menuContribution
	       locationURI="popup:org.bundlemaker.core.ui.ProjectExplorerPopupMenu">
	       <menu id="org.bundlemaker.core.ui.menus.exportAsMenu"
              label="Export as..." >
            	<command commandId="org.bundlemaker.core.ui.commands.PdePluginProjectExportHandler"
              			 style="push" />
              <command commandId="org.bundlemaker.core.ui.commands.BinaryBundleExportHandler"
              			 style="push" />
              <command commandId="org.bundlemaker.core.ui.commands.ReportExportHandler"
              			 style="push" />
	       </menu>
	   </menuContribution> 
   </extension>

   <!-- Add RunTransformation to Editor Popup Menu -->
      <extension point="org.eclipse.ui.menus">
        <menuContribution
            locationURI="popup:#TextEditorContext?after=additions">
             <command icon="icons/bundlemaker-icon-small.png"
                 commandId="org.bundlemaker.core.ui.commands.RunTransformationScript"
                 style="push"
                 tooltip="Execute this transformation on a selected BundleMaker project">
            <visibleWhen checkEnabled="true" />
         </command>  
         </menuContribution>
    </extension>
</plugin>
