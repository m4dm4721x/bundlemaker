<project name="test-bundlemaker"
         basedir="."
         default="test-bundlemaker"
         xmlns:ant4eclipse="antlib:org.ant4eclipse"
         xmlns:antcontrib="antlib:net.sf.antcontrib">

	<!-- -->
	<import file="${basedir}/common-definitions.xml" />

	<!-- ================================= 
          target: test-bundlemaker              
         ================================= -->
	<target name="test-bundlemaker">


		<delete dir="${basedir}/../destination/tests" quiet="true" />
		<mkdir dir="${basedir}/../destination/tests" />

		<!-- iterate over all projects in the workspace -->
		<ant4eclipse:executeProjectSet workspaceId="bundleMakerWorkspaceWithTests"
		                               allWorkspaceProjects="true"
		                               resolveBuildOrder="false">

			<!-- execute the contained build steps for all plug-in projects -->
			<ant4eclipse:forEachProject filter="(executeProjectSet.org.eclipse.pde.PluginNature=*)">
				
				<echo>${executeProjectSet.project.directory}/[${executeProjectSet.project.name}] </echo>

				<antcontrib:if>
					<available file="${executeProjectSet.project.directory}/[${executeProjectSet.project.name}] Test All.launch"
					           type="file" />
					<antcontrib:then>

						<!-- -->
						<echo>Launching "${executeProjectSet.project.directory}/[${executeProjectSet.project.name}] Test All.launch"</echo>

						<!-- -->
						<executePdeJunitLauncher workspaceId="bundleMakerWorkspaceWithTests"
						                         targetPlatformId="target.platform"
						                         projectName="${executeProjectSet.project.name}"
						                         launchConfigurationFile="${executeProjectSet.project.directory}/[${executeProjectSet.project.name}] Test All.launch"
						                         targetDirectory="${basedir}/../destination/tests"
						                         tempDir="${basedir}/temp" />
					</antcontrib:then>
				</antcontrib:if>

			</ant4eclipse:forEachProject>

		</ant4eclipse:executeProjectSet>

	</target>

</project>