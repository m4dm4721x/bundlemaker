<project name="deploy-bundlemaker"
         basedir="."
         default="deploy-bundlemaker"
         xmlns:ant4eclipse="antlib:org.ant4eclipse"
         xmlns:antcontrib="antlib:net.sf.antcontrib">

	<!-- Ant4Eclipse (http://www.ant4eclipse.org) -->
	<taskdef uri="antlib:org.ant4eclipse" resource="org/ant4eclipse/antlib.xml">
		<classpath>
			<fileset dir="${basedir}/../libs/ant4eclipse">
				<include name="org.ant4eclipse_*.jar" />
			</fileset>
			<fileset dir="${basedir}/../libs/ant4eclipse/libs">
				<include name="org.eclipse.osgi_*.jar" />
				<include name="ecj-*.jar" />
			</fileset>
		</classpath>
	</taskdef>

	<!-- AntContrib (http://ant-contrib.sourceforge.net/) -->
	<typedef resource="net/sf/antcontrib/antlib.xml"
	         uri="antlib:net.sf.antcontrib"
	         classpath="${basedir}/../libs/ant4eclipse/libs/ant-contrib-1.0b3.jar" />

	<!-- import a4e-pde-macros.xml -->
	<import file="${basedir}/../libs/ant4eclipse/macros/a4e-pde-macros.xml" />

	<!-- set properties -->
	<property file="${basedir}/build.properties" />

	<!-- define some helper propertiess -->
	<property name="bundlemaker-workspace" value="${basedir}/../.." />
	<property name="bundlemaker-deploy-dir" value="${basedir}/../destination" />

	<!-- define the ant4eclipse target platform -->
	<ant4eclipse:targetPlatform id="target.platform">
		<location dir="${bundlemaker-workspace}/target.platform/AST-View" />
		<location dir="${bundlemaker-workspace}/target.platform/bundlor-1.0.0.RELEASE" />
		<location dir="${bundlemaker-workspace}/target.platform/div" />
		<location dir="${bundlemaker-workspace}/target.platform/easymock-2.5.2" />
		<location dir="${bundlemaker-workspace}/target.platform/miglayout-3.7.3.1" />
		<location dir="${bundlemaker-workspace}/target.platform/slf4j-1.5.10" />
		<location dir="${eclipse.install.dir}" />
	</ant4eclipse:targetPlatform>

	<ant4eclipse:platformConfiguration id="win32.win32.x86_64"
	                                   windowingSystem="win32"
	                                   operatingSystem="win32"
	                                   architecture="x86_64" />

	<ant4eclipse:platformConfiguration id="win32.win32.x86"
	                                   windowingSystem="win32"
	                                   operatingSystem="win32"
	                                   architecture="x86" />

	<ant4eclipse:workspaceDefinition id="myWorkspace">
		<dirset dir="${bundlemaker-workspace}">
			<include name="*" />
			<exclude name=".hg" />
		</dirset>
	</ant4eclipse:workspaceDefinition>

	<!-- ================================= 
          target: deploy-bundlemaker              
         ================================= -->
	<target name="deploy-bundlemaker">

		<echo>Deploy bundlemaker to '${bundlemaker-deploy-dir}'</echo>

		<!-- step 1: export bundlemaker -->
		<delete dir="${bundlemaker-deploy-dir}/bundlemaker"
		        quiet="true" />
		<mkdir dir="${bundlemaker-deploy-dir}/bundlemaker" />

		<buildProduct workspaceId="myWorkspace"
		              productfile="./bundlemaker.product"
		              targetPlatformId="target.platform"
		              platformConfigurationId="win32.win32.x86"
		              destination="${bundlemaker-deploy-dir}/bundlemaker"
		              clearDestination="true" />

	</target>

</project>